<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Splayer — Leaderboard</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-analytics-compat.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="page-wrap">
  <h1 class="page-title">Leaderboard</h1>

  <div class="lb-card">
    <table class="lb-table" id="leaderboard">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Score</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="lbStatus" class="lb-empty" style="display:none"></div>
  </div>

  <a href="index.html" class="back-link">&larr; Back to Splayer</a>
</div>

<script src="config.js"></script>
<script>
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  var db = firebase.firestore();

  document.addEventListener('DOMContentLoaded', () => {
    const tbody  = document.querySelector('#leaderboard tbody');
    const status = document.getElementById('lbStatus');

    function showStatus(msg) {
      status.textContent = msg;
      status.style.display = 'block';
    }

    db.collection('leaderboard')
      .orderBy('score', 'desc')
      .orderBy('lastUpdated', 'asc')
      .limit(10)
      .onSnapshot(snap => {
        tbody.innerHTML = '';
        status.style.display = 'none';

        if (snap.empty) { showStatus('No scores yet — be the first!'); return; }

        let rank = 1;
        snap.forEach(doc => {
          const d = doc.data();
          const date = d.lastUpdated ? d.lastUpdated.toDate().toLocaleDateString() : '—';
          const tr = document.createElement('tr');
          tr.innerHTML =
            `<td>${rank}</td>` +
            `<td>${d.username || 'Anonymous'}</td>` +
            `<td>${d.score}</td>` +
            `<td>${date}</td>`;
          tbody.appendChild(tr);
          rank++;
        });
      }, err => {
        console.error('Leaderboard error:', err);
        showStatus('Could not load leaderboard. ' + (err.code === 'failed-precondition'
          ? 'A Firestore composite index is required — check the console for a creation link.'
          : err.message));
      });
  });
</script>
</body>
</html>
